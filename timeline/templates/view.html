{% extends "base.html" %}

{% load static %}

{% block title %}MemryHub{% endblock %}

{% block css %}
  <link rel="stylesheet" type="text/css" href={% static "timeline/css/view.css" %}>

  <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
  <script type="text/javascript">
  // The Browser API key obtained from the Google API Console.
  const developerKey = 'AIzaSyByL9-SR6OjZfHaV-YIQlxmFn9SeGTxKO8';

  // The Client ID obtained from the Google API Console. Replace with your own Client ID.
  const clientId = "416104053530-7lar744p4o8b7jqstahqiuovabi6qd4a.apps.googleusercontent.com"

  let pickerApiLoaded = false;
  const oauthToken = '{{ access_token }}';
  const parent_id = '{{ parent_id }}'
  const memory_id = '{{ memory_id }}'
  const timeline_id = '{{ timeline_id }}'
  </script>
{% endblock %}

{% block content %}
  <div class = "container-fluid">
    <div class = "row">
      <div class = "col-sm-10 center-block">
        <div class = "main-title">
          <a class ="back-button" href = "{% url 'timelines' %}"><i class="fa fa-arrow-left"></i>Back</a>
        </br>
          <h1>{{ timeline.name}}</h1>
          <a href="{% url 'edit_timeline' timeline.id %}"><span class = "edit-time-span"><i class="fa fa-edit fa-2x"></i></span></a>
          <!--<p> {{ timeline.description }}</p>-->
        </br>
          <button type="button" class="btn bottom-buffer" id = "add-memory-button" data-toggle="modal" data-target="#addMemory"><i class="fa fa-plus-circle"></i>     Add Memory</button>
        </div>
      </div>
      <div class="col-md-1 col-md-offset-1 col-sm-2">
        <a href="{% url 'timeline_sharing' timeline.id %}"><i data-toggle="tooltip" data-placement="top" title="Share timeline" class="sharing fa fa-share-alt fa-2x"></i></a>
      </div>
    </div>

    <!--First Timeline Divider-->
    {% if first_year > 0 %}
    <div class = "row">
      <div class = "col-lg 12">
        <div class="timeline-divider text-center">
          <hr/>
          <h2>{{first_year}}</h2>
          <hr/>
        </div>
      </div>
    </div>
    {% endif %}

    {% if memory_count == 0 %}
    <div class="container-fluid">
      <div class="row bottom-buffer side-buffer">
        <div class = "col-lg-12 center-block">
          <div id = "memory-tutorial" class = "card card-outline-info center-block text-center">
            <i class="fa fa-arrow-up fa-4x"></i>
            <h4>Use the "Add Memory" button to create your first memory.</h4>
          </div>
        </div>
      </div>
    </div>
    {% endif %}

    <!--Cards-->
    {% for memory in memories_with_years %}
      <!--Dividers-->
      {% if memory.divider_year > 0 %}
        <div class = "row">
          <div class = "col-lg 12">
            <div class="timeline-divider text-center">
              <hr/>
              <h2>{{memory.divider_year}}</h2>
              <hr/>
            </div>
          </div>
        </div>
      {% endif %}

      {% if memory.year > 0 %}
      <div class = "row color-row" id = "memory-{{memory.id}}">
        <div class = "col-lg-12">
          <div class="card center-block main-card" style = "width: 80%">
    				<div class="card-block header-block">
              <div class = "memory-name">
                <h3 class="card-title">{{ memory.name }}
<!--
                  {% for key, value in date_dict.items %}
                    {% if memory.id == key %}
                      {{ value }}
                    {% endif %}
                  {% endfor %}
-->
                  {% if memory.day is None and memory.month is None and memory.year is None%}

                  {% elif memory.day is None and memory.month is None%}
                    ({{ memory.year }})
                  {% elif memory.day is None %}
                    ({{ memory.month }}, {{ memory.year }})
                  {% else %}
                    ({{ memory.month }} {{memory.day}}, {{ memory.year }})
                  {% endif %}
                </h3>
                <a href="{% url 'attach_file' memory.id %}"><span class = "edit-memory-span"><i class="fa fa-edit"></i></span></a>
              </div>
              <div class = "location">
                <h5>
                {% if memory.city is None or memory.city == "" %}
                {% else %}
                  {{ memory.city }},
                {% endif %}

                {% if memory.state is None or memory.state == "" %}
                {% else %}
                  {{ memory.state }},
                {% endif %}

                {% if memory.country is None or memory.country == "" %}
                {% else %}
                  {{ memory.country }}
                {% endif %}
              </h5>
              </div>
              <p class="card-description">{{ memory.description }}</p>
              <!--<h6>{{ memory.owner.first_name }} owns this memory.</h6>-->
              <!--<a href="{% url 'attach_file' memory.id %}" class="btn btn-secondary btn-sm add-file-button">Manage Memory/Files</a>-->
              <!--<a href="" class = "collapse-link" data-toggle = "collapse" data-target = ".preview-memory-collapse-{{ memory.id }}" aria-expanded="false" aria-controls="collapseExample">Preview All</a>-->
            </div>


            <div class = "card-columns ">
            {% for file in files %}
              {% if file.memory == memory %}
              <div class = "card file-card">
                <a href="{% url 'edit_file' file.id %}"></a>
                <div class = "info-of-card">
                    <h4>
                      <!--
                      {% if file.file_type == 'audio' %}
                      <i class="fa fa-file-audio-o "></i>
                      {% elif file.file_type == 'video' %}
                      <i class="fa fa-file-video-o "></i>
                      {% elif file.file_type == 'application' %}
                      <i class="fa fa-file-text-o "></i>
                      {% elif file.file_type == 'image' %}
                      <i class="fa fa-file-image-o "></i>
                      {% else %}
                      <i class="fa fa-file-o "></i>
                      {% endif %}
                    -->
                      {{file.name}}
                    </h4>
                </div>
                <br>
                <!--<a href="" class = "collapse-link" data-toggle = "collapse" data-target = "#preview-file-collapse-{{ file.file_id }}" aria-expanded="false" aria-controls="collapseExample">Preview</a>-->
                <!--<div class="collapse preview-memory-collapse-{{ memory.id }}" id ="preview-file-collapse-{{ file.file_id }}" >-->
                <div class = "iframe-class center-block">
                  <!--<iframe class = "" frameborder="0" src="https://drive.google.com/file/d/{{ file.file_id }}/preview?usp=sharing"></iframe>-->

                  {% if file.file_type == 'audio' %}
                    <i class="fa fa-file-audio-o fa-5x"></i>
                  {% elif file.file_type == 'video' %}
                    <i class="fa fa-file-video-o fa-5x"></i>
                  {% elif file.file_type == 'application' %}
                    <iframe class = "" frameborder="0" src="https://drive.google.com/file/d/{{ file.file_id }}/preview?usp=sharing"></iframe>
                  {% elif file.file_type == 'image' %}
                    <img  class = "img-fluid" src="https://drive.google.com/uc?export=view&id={{ file.file_id }}" alt="Image">
                  {% else %}
                  <i class="fa fa-file-o "></i>
                  {% endif %}
                </div>
                <div class = "file-description">
                  {{file.description}}
                </div>
                <!--</div>-->
              </br>
              <!--Delete button
                <a class = "delete-file-button" href="" data-toggle="modal" data-target="#confirm-delete-file" >Delete File</a>
                -->
              </div>


              <!-- Modal for delete

                <div class="modal fade" id="confirm-delete-file" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                  <div class="modal-dialog">
                      <div class="modal-content">
                          <div class="modal-header">
                              <h2 >Confirm delete?</h2>
                          </div>
                          <div class="modal-body">
                              <p>Are you sure you wish to delete this file?</p>
                              <p style = "font-style: italic">Note: This will not delete the file in your Google Drive folder. This will only make the file inactive on this website. You will still have access to the file through your Google Drive.</p>
                          </div>
                          <div class="modal-footer">
                              <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                              <a href = "{% url 'delete_file' file.id %}" class="btn btn-danger btn-ok">Confirm Delete</a>
                          </div>
                      </div>
                  </div>
                </div>
              -->

              {% endif %}

              <!--
              {% if file.file_type == 'audio' and file.memory == memory %}
              <div class = "card-block audio-block">
                <h5  data-toggle ="tooltip" title = "Location: {{memory.city}}, {{memory.state}}" data-placement="bottom">{{memory.description}}</h5>
                <iframe frameborder="0" src="https://drive.google.com/file/d/{{ file.file_id }}/preview?usp=sharing" data-toggle ="tooltip" title = "Location: {{memory.city}}, {{memory.state}}" data-placement="bottom"></iframe>
              </div>
              {% endif %}

              {% if file.file_type == 'video' and file.memory == memory %}
              <div class = "card-block video-block">
                <h5 data-toggle ="tooltip" title = "Location: {{memory.city}}, {{memory.state}}" data-placement="bottom">{{memory.description}}</h5>
                <iframe frameborder="0" src="https://drive.google.com/file/d/{{ file.file_id }}/preview?usp=sharing" data-toggle ="tooltip" title = "Location: {{memory.city}}, {{memory.state}}" data-placement="bottom"></iframe>
              </div>
              {% endif %}

              {% if file.file_type == 'application' and file.memory == memory  %}
              <div class = "card-block text-block">
                <h5 data-toggle ="tooltip" title = "Location: {{memory.city}}, {{memory.state}}" data-placement="bottom">{{memory.description}}</h5>
                <iframe frameborder="0" src="https://drive.google.com/file/d/{{ file.file_id }}/preview?usp=sharing" data-toggle ="tooltip" title = "Location: {{memory.city}}, {{memory.state}}" data-placement="bottom"></iframe>
              </div>
              {% endif %}

              {% if file.file_type == 'image' and file.memory == memory %}
              <div class = "card-block picture-block">
                <h5 data-toggle ="tooltip" title = "Location: {{memory.city}}, {{memory.state}}" data-placement="bottom">{{memory.description}}</h5>
                <iframe frameborder="0" src="https://drive.google.com/file/d/{{ file.file_id }}/preview?usp=sharing" data-toggle ="tooltip" title = "Location: {{memory.city}}, {{memory.state}}" data-placement="bottom"></iframe>
              </div>
              {% endif %}
            -->
            {% endfor %}
            <a class = "no-underline" href="{% url 'attach_file' memory.id %}">
            <div class = "card add-file-card file-card center-block">
              <button type = "button" class="btn btn-primary btn-add-file-card" >Add Files</button>
              <!--<button class="btn btn-primary btn-add-file-card" id="googleDrive" onClick="onGDriveButton(); return false;" value="G_driver">Add Files</button>-->
            </div>
            </a>
          </div>


            <div class = "card-block footer-block">

              <!--eidtmemory button
              <a href="{% url 'attach_file' memory.id %}">Edit Memory</a>

              <br>
              -->
              <!--Delete memory button
              <a href="" style = "color:red" data-toggle="modal" data-target="#confirm-delete-memory">Delete Memory</a>
            -->
            </div>
  				</div>
        </div>
      </div>

      <!-- Modal for delete

        <div class="modal fade" id="confirm-delete-memory" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
          <div class="modal-dialog">
              <div class="modal-content">
                  <div class="modal-header">
                      <h2 >Confirm delete?</h2>
                  </div>
                  <div class="modal-body">
                      <p>Are you sure you wish to delete this memory?</p>
                      <p style = "font-style: italic">Note: This will not delete the file in your Google Drive folder. This will only make the file inactive on this website. You will still have access to the file through your Google Drive.</p>
                  </div>
                  <div class="modal-footer">
                      <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                      <a href = "{% url 'delete_memory' memory.id %}" class="btn btn-danger btn-ok">Confirm Delete</a>
                  </div>
              </div>
          </div>
        </div>
        -->

      {% endif %}
    {% endfor %}
  </div>

  <!--Last Timeline Divider-->
  {% if last_year > 0 %}
  <div class = "row bottom-buffer-end">
    <div class = "col-lg 12">
      <div class="timeline-divider text-center">
        <hr/>
        <h2>{{last_year}}</h2>
        <hr/>
      </div>
    </div>
  </div>
  {% endif %}

<!--  Modal for adding memory -->

  <div class="modal fade" id="addMemory" tabindex="-1" role="dialog" aria-labelledby="Label" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">New Memory</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div hidden id="required-alert" class="alert alert-danger" role="alert">
            Name and year are required inputs.
          </div>
          <form>
            {% csrf_token %}
            <div class="form-group">
              <input type="hidden" id="timeline_id" name="timeline_id" value="{{timeline.id}}">
              <label for="memory_name" class="form-control-label">Memory Name:</label>
              <input type="text" class="form-control" required id="memory_name">
            </div>
            <div class="form-group">
              <label for="memory_year" class="form-control-label">Memory Year:</label>
              <input type="number" class="form-control" required id="memory_year">
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="button" onClick="createMemory('timeline')" class="btn btn-primary">Add</button>
          <button type="button" onClick="createMemory('files')" class="btn btn-primary">Attach Files</button>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block js %}
  <script type="text/javascript" src="https://apis.google.com/js/api.js"></script>
  <script src = {% static "timeline/js/view.js" %}></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/tether/1.4.3/js/tether.min.js"></script>
{% endblock %}
