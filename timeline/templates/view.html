{% extends "base.html" %}

{% load static %}

{% block title %}MemryHub{% endblock %}

{% block css %}
  <link rel="stylesheet" type="text/css" href={% static "timeline/css/view.css" %}>
  <link rel="stylesheet" type="text/css" href={% static "home/css/font-awesome/css/font-awesome.min.css" %}>
{% endblock %}

{% block content %}
  <div class = "container-fluid">
    <div class = "row">
      <div class = "col-lg-10 center-block">
        <div class = "main-title">
          <a href = "{% url 'timelines' %}"><i class="fa fa-arrow-left"></i>Back</a>
          <h1>{{ timeline.name}}</h1>
          <p> {{ timeline.description }}</p>
          <button type="button" class="btn btn-info bottom-buffer" data-toggle="modal" data-target="#addMemory">Add Memory</button>
        </div>
      </div>
    </div>

    <!--First Timeline Divider-->
    <div class = "row">
      <div class = "col-lg 12">
        <div class="timeline-divider text-center">
          <hr/>
          <h2>{{first_year}}</h2>
          <hr/>
        </div>
      </div>
    </div>

    <!--Cards-->
    {% for memory in memories_with_years %}
      <!--Dividers-->
      {% if memory.divider_year > 0 %}
        <div class = "row">
          <div class = "col-lg 12">
            <div class="timeline-divider text-center">
              <hr/>
              <h2>{{memory.divider_year}}</h2>
              <hr/>
            </div>
          </div>
        </div>
      {% endif %}

      {% if memory.year > 0 %}
      <div class = "row">
        <div class = "col-lg 12">
          <div class="card text-center center-block" style = "width: 80%">
    				<div class="card-block header-block">
              <h3 class="card-title">{{ memory.name }}</h3>
              <h4 class ="card-subtitle">
                {% if memory.month is None %}
                {% else %}
                  {{ memory.month }}/
                {% endif %}
                {% if memory.day is None %}
                {% else %}
                  {{ memory.day }}/
                {% endif %}
                {% if memory.year is None %}
                {% else %}
                  {{ memory.year }}
                {% endif %}
              </h4>
              <p class="card-description">{{ memory.description }}</p>
              <div class = "location">
                <h5>
                {% if memory.city is None or memory.city == "" %}
                {% else %}
                  {{ memory.city }},
                {% endif %}

                {% if memory.state is None or memory.state == "" %}
                {% else %}
                  {{ memory.state }},
                {% endif %}

                {% if memory.country is None or memory.country == "" %}
                {% else %}
                  {{ memory.country }}
                {% endif %}
              </h5>
              </div>
              <a href="{% url 'attach_file' memory.id %}" class="btn btn-secondary btn-sm add-file-button">Add Files</a>
              <br>
              <a href="" class = "collapse-link" data-toggle = "collapse" data-target = ".preview-memory-collapse-{{ memory.id }}" aria-expanded="false" aria-controls="collapseExample">Preview All</a>
            </div>


            <div class = "card-columns">
            {% for file in files %}
              {% if file.memory == memory %}
              <div class = "card file-card">
                <!--<h5  data-toggle ="tooltip" title = "Location: {{memory.city}}, {{memory.state}}" data-placement="bottom">{{file.name}}</h5>-->
                <h4>{{file.name}}</h4>
                <!--<h5  data-toggle ="tooltip"  title = "Location: {{memory.city}}, {{memory.state}}" data-placement="top">{{file.name}}</h5>-->
                <a href="https://drive.google.com/file/d/{{ file.file_id }}/preview?usp=sharing" target="_blank">
                  {% if file.file_type == 'audio' %}
                  <i class="fa fa-file-audio-o "></i>
                  {% elif file.file_type == 'video' %}
                  <i class="fa fa-file-video-o "></i>
                  {% elif file.file_type == 'application' %}
                  <i class="fa fa-file-text-o "></i>
                  {% elif file.file_type == 'image' %}
                  <i class="fa fa-file-image-o "></i>
                  {% else %}
                  <i class="fa fa-file-o "></i>
                  {% endif %}
                </a>
                <br>
                <a href="" class = "collapse-link" data-toggle = "collapse" data-target = "#preview-file-collapse-{{ file.file_id }}" aria-expanded="false" aria-controls="collapseExample">Preview</a>
                <div class="collapse preview-memory-collapse-{{ memory.id }}" id ="preview-file-collapse-{{ file.file_id }}" >
                  <iframe frameborder="0" src="https://drive.google.com/file/d/{{ file.file_id }}/preview?usp=sharing" data-toggle ="tooltip" title = "Location: {{memory.city}}, {{memory.state}}" data-placement="bottom"></iframe>
                </div>
              </br>
                <a class = "delete-file-button" href="" data-toggle="modal" data-target="#confirm-delete-file" >Delete File</a>
              </div>

              <!-- Modal for delete -->

                <div class="modal fade" id="confirm-delete-file" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                  <div class="modal-dialog">
                      <div class="modal-content">
                          <div class="modal-header">
                              <h2 >Confirm delete?</h2>
                          </div>
                          <div class="modal-body">
                              <p>Are you sure you wish to delete this file?</p>
                              <p style = "font-style: italic">Note: This will not delete the file in your Google Drive folder. This will only make the file inactive on this website. You will still have access to the file through your Google Drive.</p>
                          </div>
                          <div class="modal-footer">
                              <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                              <a href = "{% url 'delete_file' file.id %}" class="btn btn-danger btn-ok">Confirm Delete</a>
                          </div>
                      </div>
                  </div>
                </div>

              {% endif %}

              <!--
              {% if file.file_type == 'audio' and file.memory == memory %}
              <div class = "card-block audio-block">
                <h5  data-toggle ="tooltip" title = "Location: {{memory.city}}, {{memory.state}}" data-placement="bottom">{{memory.description}}</h5>
                <iframe frameborder="0" src="https://drive.google.com/file/d/{{ file.file_id }}/preview?usp=sharing" data-toggle ="tooltip" title = "Location: {{memory.city}}, {{memory.state}}" data-placement="bottom"></iframe>
              </div>
              {% endif %}

              {% if file.file_type == 'video' and file.memory == memory %}
              <div class = "card-block video-block">
                <h5 data-toggle ="tooltip" title = "Location: {{memory.city}}, {{memory.state}}" data-placement="bottom">{{memory.description}}</h5>
                <iframe frameborder="0" src="https://drive.google.com/file/d/{{ file.file_id }}/preview?usp=sharing" data-toggle ="tooltip" title = "Location: {{memory.city}}, {{memory.state}}" data-placement="bottom"></iframe>
              </div>
              {% endif %}

              {% if file.file_type == 'application' and file.memory == memory  %}
              <div class = "card-block text-block">
                <h5 data-toggle ="tooltip" title = "Location: {{memory.city}}, {{memory.state}}" data-placement="bottom">{{memory.description}}</h5>
                <iframe frameborder="0" src="https://drive.google.com/file/d/{{ file.file_id }}/preview?usp=sharing" data-toggle ="tooltip" title = "Location: {{memory.city}}, {{memory.state}}" data-placement="bottom"></iframe>
              </div>
              {% endif %}

              {% if file.file_type == 'image' and file.memory == memory %}
              <div class = "card-block picture-block">
                <h5 data-toggle ="tooltip" title = "Location: {{memory.city}}, {{memory.state}}" data-placement="bottom">{{memory.description}}</h5>
                <iframe frameborder="0" src="https://drive.google.com/file/d/{{ file.file_id }}/preview?usp=sharing" data-toggle ="tooltip" title = "Location: {{memory.city}}, {{memory.state}}" data-placement="bottom"></iframe>
              </div>
              {% endif %}
            -->
            {% endfor %}
          </div>

            <div class = "card-block footer-block">
              <h6>Memory Owner: {{ memory.owner.first_name }}</h6>
              <a href="{% url 'attach_file' memory.id %}">Edit Memory</a>
              <br>
              <a href="" style = "color:red" data-toggle="modal" data-target="#confirm-delete-memory">Delete Memory</a>
            </div>
  				</div>
        </div>
      </div>

      <!-- Modal for delete -->

        <div class="modal fade" id="confirm-delete-memory" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
          <div class="modal-dialog">
              <div class="modal-content">
                  <div class="modal-header">
                      <h2 >Confirm delete?</h2>
                  </div>
                  <div class="modal-body">
                      <p>Are you sure you wish to delete this memory?</p>
                      <p style = "font-style: italic">Note: This will not delete the file in your Google Drive folder. This will only make the file inactive on this website. You will still have access to the file through your Google Drive.</p>
                  </div>
                  <div class="modal-footer">
                      <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                      <a href = "{% url 'delete_memory' memory.id %}" class="btn btn-danger btn-ok">Confirm Delete</a>
                  </div>
              </div>
          </div>
        </div>


      {% endif %}
    {% endfor %}
  </div>

  <!--Last Timeline Divider-->
  <div class = "row">
    <div class = "col-lg 12">
      <div class="timeline-divider text-center">
        <hr/>
        <h2>{{last_year}}</h2>
        <hr/>
      </div>
    </div>
  </div>

<!--  Modal for adding memory -->

  <div class="modal fade" id="addMemory" tabindex="-1" role="dialog" aria-labelledby="Label" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">New Memory</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div hidden id="required-alert" class="alert alert-danger" role="alert">
            Name and year are required inputs.
          </div>
          <form>
            {% csrf_token %}
            <div class="form-group">
              <input type="hidden" id="timeline_id" name="timeline_id" value="{{timeline.id}}">
              <label for="memory_name" class="form-control-label">Memory Name:</label>
              <input type="text" class="form-control" required id="memory_name">
            </div>
            <div class="form-group">
              <label for="memory_year" class="form-control-label">Memory Year:</label>
              <input type="number" class="form-control" required id="memory_year">
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="button" onClick="createMemory('timeline')" class="btn btn-primary">Add</button>
          <button type="button" onClick="createMemory('files')" class="btn btn-primary">Attach Files</button>
        </div>
      </div>
    </div>
  </div>



{% endblock %}

{% block js %}
  <script src = {% static "timeline/js/view.js" %}></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/tether/1.4.3/js/tether.min.js"></script>
{% endblock %}
