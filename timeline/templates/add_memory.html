{% extends "base.html" %}

{% load static %}

{% block title %}MemryHub{% endblock %}

{% block css %}
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<script type="text/javascript">
// The Browser API key obtained from the Google API Console.
var developerKey = 'AIzaSyByL9-SR6OjZfHaV-YIQlxmFn9SeGTxKO8';

// The Client ID obtained from the Google API Console. Replace with your own Client ID.
var clientId = "416104053530-7lar744p4o8b7jqstahqiuovabi6qd4a.apps.googleusercontent.com"

var pickerApiLoaded = false;
var oauthToken = '{{ access_token }}';

// Use the API Loader script to load google.picker and gapi.auth.
function onGDriveButton() {
  gapi.load('picker', {'callback': onPickerApiLoad});
}

function onPickerApiLoad() {
  pickerApiLoaded = true;
  createPicker();
}

function createPicker() {
  if (pickerApiLoaded && oauthToken) {
    let view = new google.picker.View(google.picker.ViewId.DOCS);

    var picker = new google.picker.PickerBuilder().
        enableFeature(google.picker.Feature.MULTISELECT_ENABLED).
        addView(view).
        addView(new google.picker.DocsUploadView().setParent('{{ parent_id }}')).
        setOAuthToken(oauthToken).
        setDeveloperKey(developerKey).
        setCallback(pickerCallback).
        build();
    picker.setVisible(true);
  }
}

// A simple callback implementation.
function pickerCallback(data) {
  if (data[google.picker.Response.ACTION] == google.picker.Action.PICKED) {
    let docArray = data[google.picker.Response.DOCUMENTS]

    for (let i = 0; i < docArray.length; i++) {
      var doc = docArray[i]
      console.log(doc)
      let type = doc.mimeType.indexOf('/')

      type = doc.mimeType.substring(0, type)
    }
    //
    // document.getElementById('file_id').value = doc.id
    // document.getElementById('file_name').value = doc.name
    // document.getElementById('file_description').value = doc.description
    // document.getElementById('file_type').value = type
    //
    // document.getElementById('file').innerHTML = doc.name
    // document.getElementById('file_div').removeAttribute('hidden')
    // document.getElementById("googleDrive").disabled = true;
  }
}
</script>
{% endblock %}

{% block content %}
<br>
  <div class="container col-sm-4 col-sm-offset-4">
    <h1>Add a Memory</h1>
    <div class="row">
      <form method="POST">
        {% csrf_token %}

        {{ form.memory_name }}
        {{ form.memory_description }}
        {{ form.start_year }}

        {{ form.file_id }}
        {{ form.file_name }}
        {{ form.file_description }}
        {{ form.file_type }}

        <br>
        <button type = "button" class="btn btn-sm btn-secondary" data-toggle = "collapse" data-target = "#form-collapse" aria-expanded="false" aria-controls="collapseExample">More Options</button>
        <div class="collapse" id="form-collapse">
          <div class="card card-block">
            {{ form.start_day }}
            {{ form.start_month }}
            {{ form.city }}
            {{ form.state }}
            {{ form.country }}
          </div>
        </div>
        <br>
        <br>
        <div hidden id='file_div' class="row">
          <h5>Attached File:</h5>
          <p id="file"></p>
        </div>
        <div class="row">
          <div class="create-timeline">
            <button class="btn btn-primary" id="googleDrive" onClick="onGDriveButton(); return false;" value="G_driver">Attach File</button>
            <button class="btn btn-primary" type="submit" name="action">Add Memory</button>
          </div>
        </div>
    </form>
    </div>
  </div>
  <script type="text/javascript" src="https://apis.google.com/js/api.js"></script>
{% endblock %}
