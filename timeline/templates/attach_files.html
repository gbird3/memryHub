{% extends "base.html" %}

{% load static %}

{% block title %}MemryHub{% endblock %}

{% block css %}
<link rel="stylesheet" type="text/css" href={% static "timeline/css/attach_files.css" %}>
<link rel="stylesheet" type="text/css" href={% static "home/css/font-awesome/css/font-awesome.min.css" %}>

<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<script type="text/javascript">
// The Browser API key obtained from the Google API Console.
const developerKey = 'AIzaSyByL9-SR6OjZfHaV-YIQlxmFn9SeGTxKO8';

// The Client ID obtained from the Google API Console. Replace with your own Client ID.
const clientId = "416104053530-7lar744p4o8b7jqstahqiuovabi6qd4a.apps.googleusercontent.com"

let pickerApiLoaded = false;
const oauthToken = '{{ access_token }}';
const parent_id = '{{ parent_id }}'
const memory_id = '{{ memory_id }}'
const timeline_id = '{{ timeline_id }}'
</script>
{% endblock %}

{% block content %}
<br>
  <div class="container-fluid col-sm-10 col-sm-offset-10">
    <div class = "header-class ">
      <a href = "{% url 'view' memory_id %}"><i class="fa fa-arrow-left"></i>Back</a>
      <h1>Manage Memory/Files</h1>
    </div>
    </br>
  </div>
  <div class ="container-fluid col-sm-4">
    <div class="row center-block">
      <form method="POST">
        {% csrf_token %}

        {{ form.memory_name }}
        {{ form.memory_description }}
        {{ form.start_year }}

        <br>
        <button type = "button" class="btn btn-sm btn-secondary" data-toggle = "collapse" data-target = "#form-collapse" aria-expanded="false" aria-controls="collapseExample">More Options</button>
        <div class="collapse" id="form-collapse">
          <div class="card card-block">
            {{ form.start_day }}
            {{ form.start_month }}
            {{ form.city }}
            {{ form.state }}
            {{ form.country }}
          </div>
        </div>
        <br>
        <br>
        <div class="row">
          {% if files %}
          <table class="table">
            <thead>
              <tr>
                <th>File Name</th>
                <th>Description</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for file in files %}
              <tr>
                <td>{{ file.name }}</td>
                <td>{{ file.description }}</td>
                <td><a href="{% url 'edit_file' file.id %}">Edit</a>/<a style = "color:red" href="" data-toggle="modal" data-target="#confirm-delete-file" >Delete</a></td>
              </tr>

              <!-- Modal for delete-->

                <div class="modal fade" id="confirm-delete-file" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                  <div class="modal-dialog">
                      <div class="modal-content">
                          <div class="modal-header">
                              <h2 >Confirm delete?</h2>
                          </div>
                          <div class="modal-body">
                              <p>Are you sure you wish to delete this file?</p>
                              <p style = "font-style: italic">Note: This will not delete the file in your Google Drive folder. This will only make the file inactive on this website. You will still have access to the file through your Google Drive.</p>
                          </div>
                          <div class="modal-footer">
                              <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                              <a href ="{% url 'delete_file' file.id %}" class="btn btn-danger btn-ok">Confirm Delete</a>
                          </div>
                      </div>
                  </div>
                </div>


              {% endfor %}
            </tbody>
          </table>
          {% else %}
          <p>This memory doesn't have any files. Upload some by clicking the <button class="btn btn-primary btn-sm" id="googleDrive" onClick="onGDriveButton(); return false;" value="G_driver">Add Files</button> button.</p>
          {% endif %}
        </div>
        <div class="row">
          <div class="create-timeline center-block">
            <button class="btn btn-primary" id="googleDrive" onClick="onGDriveButton(); return false;" value="G_driver">Add Files</button>
            <button id="save-memory" class="btn btn-primary" type="submit" name="action">Save</button>
            <button type = "button" class = "btn btn-danger" data-toggle="modal" data-target="#confirm-delete-memory">Delete Memory</a>
          </div>

          <!-- Modal for delete memory -->

            <div class="modal fade" id="confirm-delete-memory" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
              <div class="modal-dialog">
                  <div class="modal-content">
                      <div class="modal-header">
                          <h2 >Confirm delete?</h2>
                      </div>
                      <div class="modal-body">
                          <p>Are you sure you wish to delete this memory?</p>
                          <p style = "font-style: italic">Note: This will not delete the file in your Google Drive folder. This will only make the file inactive on this website. You will still have access to the file through your Google Drive.</p>
                      </div>
                      <div class="modal-footer">
                          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                          <a href = "{% url 'delete_memory' memory_id %}" class="btn btn-danger btn-ok">Confirm Delete</a>
                      </div>
                  </div>
              </div>
            </div>


        </div>
    </form>
    </div>
  </div>
  <script type="text/javascript" src="https://apis.google.com/js/api.js"></script>
</br>
{% endblock %}

{% block js %}
  <script src = {% static "timeline/js/attach_files.js" %}></script>
{% endblock %}
